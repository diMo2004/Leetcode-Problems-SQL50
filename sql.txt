1757. Recyclable and Low Fat Products:
Select product_id 
from Products 
where low_fats = 'Y' and recyclable = 'Y';

584. Find Customer Referee:
Select name 
from Customer 
where referee_id is null or referee_id != 2;

595. Big Countries:
Select name, population, area 
from World 
where area >= 3000000 or population >= 25000000;

1148. Article Views I:
Select distinct author_id as id 
from Views 
where author_id = viewer_id 
order by author_id; 

1683. Invalid Tweets:
Select tweet_id 
from Tweets 
where char_length(content) > 15;

1378. Replace Employee ID with the Unique Identifier:
Select unique_id, name 
from Employees left outer join EmployeeUNI 
on Employees.id = EmployeeUNI.id;

1068. Products Sales Analysis I:
Select product_name, year, price 
from Sales inner join Product 
on Sales.product_id = Product.product_id;

1581. Customer Who Visited but Did Not Make Any Transactions:
Select customer_id, count(customer_id) 
as count_no_trans 
from Visits left outer join Transactions 
on Visits.visit_id = Transactions.visit_id 
where Transactions.visit_id is null 
group by customer_id;

197. Rising Temperature:
Select distinct W1.id 
from Weather as W1 cross join Weather as W2 
where DateDiff(W1.recordDate, W2.recordDate) = 1 and 
W1.temperature > W2.temperature;

1661. Average Time of Process per Machine:
Select machine_id, 
round(
    sum(
        case 
        when activity_type = 'start' 
        then timestamp*-1 
        else timestamp end
        )*1.0/
        (Select count(distinct process_id)),3
    ) as processing_time 
from Activity 
group by machine_id;

1280. Students and Examinations:
Select Students.student_id, 
student_name, 
Subjects.subject_name, 
count(Examinations.student_id) as attended_exams 
from Students cross join Subjects left join Examinations 
on Students.student_id = Examinations.student_id 
and Subjects.subject_name = Examinations.subject_name 
group by Students.student_id, student_name, Subjects.subject_name 
order by Students.student_id, student_name, Subjects.subject_name;

570. Managers with at Least 5 Direct Reports:
SELECT E1.name
FROM Employee E1
JOIN (
    SELECT managerId, COUNT(*) AS directReports
    FROM Employee
    GROUP BY managerId
    HAVING COUNT(*) >= 5
) E2 ON E1.id = E2.managerId;

1934. Confirmation Rate:
Select Signups.user_id, 
round(
    (sum
    (case 
    when action = 'confirmed' then 1 
    when action is null then 0 
    else 0 end)*1.0)/
    (Select count(case when action is null then Signups.user_id else action end)),2) as confirmation_rate 
from Signups left join Confirmations 
on Signups.user_id = Confirmations.user_id 
group by Signups.user_id;

620. Boring Movies:
Select id, movie, description, rating 
from Cinema 
where description != 'boring' 
and id % 2 != 0 
order by rating desc;

1251. Average Selling Price:
Select Prices.product_id, 
round((sum(
    case when UnitsSold.units is not null then Prices.price*UnitsSold.units 
    when UnitsSold.units is null then 0 end)*1.0)/
    (Select sum(
        case when UnitsSold.units is not null then UnitsSold.units 
        when UnitsSold.units is null then 1 end)),2) as average_price 
from Prices left join UnitsSold 
on Prices.product_id = UnitsSold.product_id 
where purchase_date is null 
or timestamp(UnitsSold.purchase_date) >= timestamp(Prices.start_date) 
and timestamp(UnitsSold.purchase_date) <= timestamp(Prices.end_date) 
group by Prices.product_id;

1075. Project Employees I:
Select project_id, 
round(avg(experience_years),2) as average_years 
from Project inner join Employee 
on Project.employee_id = Employee.employee_id 
group by project_id;

1633. Percentage of Users Attended a Contest:
Select contest_id, round((count(Register.user_id)*100.0)/(Select count(*) from Users),2) as percentage 
from Users inner join Register on Users.user_id = Register.user_id
group by contest_id
order by percentage desc, contest_id asc;

1211. Queries Quality and Percentage:
Select
query_name,
round(avg(rating/position),2) as quality,
round((count(case when rating < 3 then rating end)*100.0)/(Select count(rating)),2) as poor_query_percentage
from Queries
group by query_name;

1193. Monthly Transactions I:
Select
date_format(trans_date, '%Y-%m') as month,
country,
count(id) as trans_count,
count(case when state = 'approved' then state end) as approved_count,
sum(amount) as trans_total_amount,
sum(case when state = 'approved' then amount else 0 end) as approved_total_amount
from Transactions
group by month, country;

1174. Immediate Food Delivery II:
With FirstOrder as (
    Select customer_id, min(order_date) as first_order_date
    from delivery
    group by customer_id
),
ImmediateFIrstOrder as (
    Select count(FirstOrder.customer_id) as immediate
    from FirstOrder inner join Delivery
    on FirstOrder.customer_id = Delivery.customer_id and FirstOrder.first_order_date = Delivery.order_date
    where FirstOrder.first_order_date = Delivery.customer_pref_delivery_date
),
TotalOrders as (
    Select count(distinct customer_id) as total
    from Delivery
)
Select round((Select immediate from ImmediateFirstOrder)*100.0/(Select total from TotalOrders),2) as immediate_percentage;

550. Game Play Analysis IV:
with FirstDate as (
    Select player_id as p,
    min(event_date) as first_date
    from Activity group by player_id
), SecondDate as (
    Select A.player_id as play_id, 
    A.event_date as second_date
    from FirstDate as FD cross join Activity as A
    on FD.p = A.player_id 
    where DateDiff(A.event_date,FD.first_date) = 1
), CountPlayers as (
    Select count(distinct play_id) as players
    from SecondDate
), TotalPlayers as (
    Select count(distinct player_id) as total
    from Activity
)
Select round((Select players from CountPlayers)*1.0/(Select total from TotalPlayers),2) as fraction;

2356. Number of Unique Subjects Taught by Each Teacher:
Select teacher_id,
count(distinct subject_id) as cnt
from Teacher group by teacher_id;

1141. User Activity for the Past 30 Days I:
Select activity_date as day,
count(distinct user_id) as active_users
from Activity where timestamp(Activity.activity_date) <= timestamp('2019-07-27') and 
timestamp(Activity.activity_date) >= timestamp('2019-06-28') 
group by day;

1070. Product Sales Analysis III:
with FirstYear as (
    Select product_id,
    min(year) as first_year
    from Sales group by product_id
)
Select FY.product_id, FY.first_year,
S.quantity, S.price
from FirstYear as FY inner join Sales as S
on FY.product_id = S.product_id and FY.first_year = S.year;

596. Classes More Than 5 Students:
with CNT as (
    Select class, 
    count(student) as cnt 
    from Courses group by class
)
Select distinct Courses.class from Courses cross join CNT on Courses.class = CNT.class where CNT.cnt >= 5;

1729. Find Followers Count:
Select user_id,
count(follower_id) as followers_count
from Followers 
group by user_id
order by user_id;

619. Biggest Single Number:
with Frequency as (
    Select num, 
    count(num) as freq
    from MyNumbers
    group by num 
), SingleNumber as (
    Select num
    from Frequency
    where freq = 1
)
Select max(num) as num from SingleNumber;

1045. Customers Who Bought All Products:
with TotalProducts as (
    Select count(*) as total 
    from Product
), BoughtProducts as (
    Select customer_id,
    count(distinct product_key) as bought
    from Customer
    group by customer_id
)
Select customer_id from TotalProducts, BoughtProducts where total = bought;

1731. The Number of Employees Which Report to Each Employee:
with Report as (
    Select reports_to, 
    count(reports_to) as reports_count, 
    round(avg(age)) as average_age 
    from Employees 
    group by reports_to
)
Select employee_id, name, reports_count, average_age 
from Employees inner join Report
on Employees.employee_id = Report.reports_to
order by employee_id;

1789. Primary Department for Each Employee:
with Dept as (
    Select employee_id, 
    count(department_id) as dept_count
    from Employee
    group by employee_id
)
Select Employee.employee_id, Employee.department_id
from Employee inner join Dept
on Employee.employee_id = Dept.employee_id
where dept_count = 1 or primary_flag = 'Y';

610. Triangle Judgement:
Select x, y, z,
(case when x+y > z and y+z > x and z+x>y then 'Yes'
else 'No'
end) as triangle
from Triangle;

180. Consecutive Numbers:
Select distinct l1.num as ConsecutiveNums
from Logs as l1 inner join Logs as l2 inner join Logs as l3
on l1.num = l2.num and l2.num = l3.num
where l2.id - l1.id = 1 and l3.id - l2.id = 1;

1164. Product Price at a Given Date:
Select product_id, 10 as price
from Products
group by product_id having min(change_date) > '2019-08-16'
union all
Select product_id, new_price as price
from Products where (product_id, change_date) in (
    Select product_id, max(change_date)
    from Products
    where change_date <= '2019-08-16'
    group by product_id
)

1204. Last Person to Fit in the Bus:
with Cumulative_Sum as (
    Select person_id, person_name, 
    sum(weight) over (order by turn) as cs
    from Queue
), Target as (
    Select person_name, cs from Cumulative_Sum 
    where cs <= 1000
)
Select distinct first_value(person_name) over (order by cs desc) as person_name from Target;

1907. Count Salary Categories:
Select 'Low Salary' as category,
count(*) as accounts_count
from Accounts
where income < 20000
union all
Select 'Average Salary' as category,
count(*) as accounts_count
from Accounts
where income >= 20000 and income <= 50000
union all
Select 'High Salary' as category,
count(*) as accounts_count
from Accounts
where income > 50000;

1978. Employees Whose Manager Left the Company:
Select employee_id
from Employees
where salary < 30000
and manager_id not in (Select employee_id from Employees)
order by employee_id;

626. Exchange Seats:
Select 
case when id % 2 = 1 and id < (Select max(id) from Seat) then id + 1
when id % 2 = 0 then id - 1
else id end as id,
student
from Seat
order by id;

1341. Movie Rating:
with Rating_Counter as (
    Select MovieRating.user_id, name, count(rating) as cnt,
    max(count(rating)) over () as greatest
    from MovieRating inner join Users 
    on MovieRating.user_id = Users.user_id 
    group by user_id
), Avg_Rating_Counter as (
    Select MovieRating.movie_id, title, avg(rating) as avg,
    max(avg(rating)) over () as greatest
    from MovieRating inner join Movies 
    on MovieRating.movie_id = Movies.movie_id
    where date_format(created_at, '%Y-%m') = '2020-02'
    group by MovieRating.movie_id
), Highest_Rating as (
    Select dense_rank() over (order by name) as rnk, name
    from Rating_Counter where cnt = greatest
), Avg_Highest_Rating as (
    Select dense_rank() over (order by title) as rnk, title
    from Avg_Rating_Counter where avg = greatest
)
Select name as results from Highest_rating where rnk = 1
union all
Select title as results from Avg_Highest_Rating where rnk = 1;

1321. Restaurant Growth:
with Date_mod as ( 
    Select date_add(visited_on, interval 6 day) as visited_on
    from Customer
), Final_date as (
    Select distinct Date_mod.visited_on as visited_on 
    from Date_mod inner join Customer 
    on Date_mod.visited_on = Customer.visited_on
)
Select Final_date.visited_on, sum(amount) as amount,
round(sum(amount)/7, 2) as average_amount 
from Customer, Final_date 
where Final_date.visited_on >= Customer.visited_on and datediff(Final_date.visited_on,Customer.visited_on) < 7 
and datediff(Final_date.visited_on,Customer.visited_on) >= 0
group by Final_date.visited_on;

602. Friend Requests II: Who Has the Most Friends:
with ids as (
    Select requester_id as id from RequestAccepted
    union all
    Select accepter_id as id from RequestAccepted
)
Select id, count(id) as num
from ids
group by id
order by count(id) desc
limit 1

585. Investments in 2016:
Select round(sum(tiv_2016), 2) as tiv_2016
from Insurance
where tiv_2015 in (Select tiv_2015 from insurance group by tiv_2015 having count(*) > 1)
and (lat, lon) in (Select lat, lon from insurance group by lat,lon having count(*) = 1);

1667. Fix Names in a Table:
Select user_id, 
concat(upper(substr(name,1,1)),lower(substr(name,2))) as name
from Users
order by user_id;

1527. Patients With a Condition:
Select patient_id, patient_name, conditions
from Patients
where conditions REGEXP '^(([A-Za-z0-9]* )*)?DIAB1';

196. Delete Duplicate Emails:
Delete P1 
from Person P1 inner join (Select min(id) as id, email from Person group by email) as P2 
on P1.email = P2.email 
where P1.id > P2.id;

176. Second Highest Salary:
with Sorted as (
    Select distinct salary,
    row_number() over (order by salary desc) as num
    from Employee
    group by salary
)
Select 
case when max(num) > 1 then max(case when num = 2 then salary end)
else null end as SecondHighestSalary
from Sorted;

1484. Group Sold Products By The Date:
Select sell_date,
count(distinct product) as num_sold,
group_concat(distinct product order by product separator ',') as products
from Activities
group by sell_date
order by sell_date;

1327. List the Products Ordered in a Period:
with filter_order as (
    Select product_id, sum(unit) as unit
    from Orders
    where date_format(order_date, '%Y-%m') = '2020-02'
    group by product_id
)
Select product_name, unit
from Products inner join filter_order
on Products.product_id = filter_order.product_id
where unit >= 100;

1517. Find Users With Valid E-Mails:
Select user_id, name, mail
from Users where mail REGEXP '^[A-Za-z]([A-Za-z0-9\_\.\-])*(@leetcode[\.]com)$';
